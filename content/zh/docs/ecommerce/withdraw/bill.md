---
title: '按日下载提现异常文件API'
linkTitle: '下载提现异常'
date: '2020-2-18'
weight: 5
description: >
  电商服务商按日查询并下载提现状态为异常的提现单, 提现异常包括提现失败和银行退票。
type: 'docs'
---

{{% alert title="注意" color="warning"%}}

- 每日 09:00 开始可以下载前一日的提现异常文件, 支持下载 90 天内提现状态变为提现异常的提现单文件。
- 日期(date）字段为提现状态变为提现异常的日期。建议输入日期为昨日, 每天定时(早上 9 点后）查询昨日是否有状态为异常的提现单。
- 电商服务商查询的结果包括电商服务商发起的提现和给电商二级商户发起的提现。
- 同一笔提现的相同数据可能出现在不同日期。即提现单 A 的失败数据, 可能同时出现在 1 日和 3 日。
- 历史数据如果有某一日遗漏, 则系统会补入当天的账单中。例如: 今日为 2019-11-15 日, 发现 2019-11-12 日某数据遗漏, 则该数据会补入 2019-11-15 日。

{{% /alert %}}

## 接口说明

**适用对象**: 电商平台\
**请求 URL**: https://api.mch.weixin.qq.com/v3/merchant/fund/withdraw/bill-type/{bill_type}\
**请求方式**: GET\
**接口规则**: https://wechatpay-api.gitbook.io/wechatpay-api-v3

`path` 指该参数需在请求 URL 传参\
`query` 指该参数需在请求 JSON 传参

## 请求参数

| 变量      | 类型        | 必填 | 参数名/描述/示例值                                                                                                                                                                       |
| --------- | ----------- | ---- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| bill_type | string(8)   | 是   | `path` `账单类型` NO_SUCC: 提现异常账单, 包括提现失败和提现退票账单。                                                                                                                    |
|           |             |      | NO_SUCC                                                                                                                                                                                  |
| bill_date | string(10） | 是   | `path` `账单日期` 表示所在日期的提现账单, 格式为 YYYY-MM-DD。<br>例如: 2008-01-01 日发起的提现, 2008-01-03 日银行返回提现失败, 则该提现数据将出现在 bill_date 为 2008-01-03 日的账单中。 |
|           |             |      | 2019-08-17                                                                                                                                                                               |
| tar_type  | enum        | 否   | `path` `压缩格式` 不填则默认是数据流<br>枚举值: <br>GZIP: 返回格式为.gzip 的压缩包账单                                                                                                   |
|           |             |      | GZIP                                                                                                                                                                                     |

### 请求示例

`URL` https://api.mch.weixin.qq.com/v3/merchant/fund/withdraw/bill-type/NO_SUCC?bill_date=2019-08-17&tar_type=GZIP

## 返回参数

| 变量         | 类型         | 必填 | 参数名/描述/示例值                                                      |
| ------------ | ------------ | ---- | ----------------------------------------------------------------------- |
| hash_type    | string(32)   | 是   | 从 download_url `哈希类型` 下载的文件的哈希类型, 用于校验文件的完整性。 |
|              |              |      | SHA1                                                                    |
| hash_value   | string(1024) | 是   | 从 download_url `哈希值` 下载的文件的哈希值, 用于校验文件的完整性。     |
|              |              |      | 79bb0f45fc4c42234a918000b2668d689e2bde04                                |
| download_url | string(2048) | 是   | `账单下载地址` 供下一步请求账单文件的下载地址, 该地址 30s 内有效。      |
|              |              |      | https://api.mch.weixin.qq.com/v3/billdownload/file?token=xxx            |

### 返回示例

正常示例

```json
{
  "hash_type": "SHA1",
  "hash_value": "79bb0f45fc4c42234a918000b2668d689e2bde04",
  "download_url": "https://xxxx.xxx.xxx"
}
```

## 错误码<sub>公共错误码</sub>

| 状态码 | 错误码             | 描述                           | 解决方案                                                                                            |
| ------ | ------------------ | ------------------------------ | --------------------------------------------------------------------------------------------------- |
| 403    | NO_AUTH            | 当前商户号没有使用该接口的权限 | 请确认是否已经开通相关权限                                                                          |
| 400    | INVALID_REQUEST    | 请求的账单日期已过期           | 请检查 bill_date, 并重新调用                                                                        |
| 400    | NO_STATEMENT_EXIST | 请求的账单文件不存在           | 请检查当前商户号请求的微信支付账户在指定日期是否有资金操作                                          |
| 400    | STATEMENT_CREATING | 请求的账单正在生成中           | 请先检查当前商户号的微信支付账户在指定日期内是否有资金操作, 若有, 则在 T+1 日上午 10 点后再重新下载 |
| 500    | SYSTEM_ERROR       | 系统错误                       | 系统异常, 请使用相同参数稍后重新调用                                                                |
| 400    | PARAM_ERROR        | 参数错误                       | 请使用正确的参数重新调用                                                                            |
